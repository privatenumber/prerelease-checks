"use strict"; function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var _chunkCJWOCGNFjs = require('./chunk-CJWOCGNF.js');var _chunkZEVP7U72js = require('./chunk-ZEVP7U72.js');var _chunkF4DAITINjs = require('./chunk-F4DAITIN.js');var j=_chunkF4DAITINjs.c.call(void 0, (Y,_)=>{_.exports={name:"prerelease-checks",version:"0.0.0-semantic-release",description:"Run essential pre-release checks before releasing an npm package",keywords:["npm","prerelease","publish","checks","github"],license:"MIT",repository:"privatenumber/prerelease-checks",funding:"https://github.com/privatenumber/prerelease-checks?sponsor=1",author:{name:"Hiroki Osame",email:"hiroki.osame@gmail.com"},files:["dist","bin"],main:"dist/index.js",bin:"bin/prerelease-checks.js",scripts:{lint:"eslint .",build:"rm -rf dist && tsup src --minify","build-watch":"watchlist src -- npm run build",start:"esno src"},husky:{hooks:{"pre-commit":"lint-staged"}},"lint-staged":{"*.ts":"eslint"},dependencies:{listr:"^0.14.3"},devDependencies:{"@pvtnbr/eslint-config-typescript":"^0.1.13","@types/node":"^14.14.37","@types/semver":"^7.3.4",cac:"^6.7.2",eslint:"^7.23.0",esno:"^0.5.0",execa:"^5.0.0",husky:"^4.0.0","is-reachable":"^5.0.0","is-scoped":"^2.1.0","lint-staged":"^10.5.4","read-pkg-up":"^7.0.1","registry-url":"^5.1.0",semver:"^7.3.5",tsup:"^4.8.21",typescript:"^4.2.3","validate-npm-package-name":"^3.0.0",watchlist:"^0.2.3"},eslintConfig:{extends:"@pvtnbr/eslint-config-typescript"}}});var _events = require('events');function b(o){return o==null?[]:Array.isArray(o)?o:[o]}function V(o,e,s,t){var n,i=o[e],a=~t.string.indexOf(e)?s==null||s===!0?"":String(s):typeof s=="boolean"?s:~t.boolean.indexOf(e)?s==="false"?!1:s==="true"||(o._.push((n=+s,n*0==0?n:s)),!!s):(n=+s,n*0==0?n:s);o[e]=i==null?a:Array.isArray(i)?i.concat(a):[i,a]}function R(o,e){o=o||[],e=e||{};var s,t,n,i,a,c={_:[]},l=0,r=0,h=0,p=o.length;let m=e.alias!==void 0,u=e.unknown!==void 0,y=e.default!==void 0;if(e.alias=e.alias||{},e.string=b(e.string),e.boolean=b(e.boolean),m)for(s in e.alias)for(t=e.alias[s]=b(e.alias[s]),l=0;l<t.length;l++)(e.alias[t[l]]=t.concat(s)).splice(l,1);for(l=e.boolean.length;l-- >0;)for(t=e.alias[e.boolean[l]]||[],r=t.length;r-- >0;)e.boolean.push(t[r]);for(l=e.string.length;l-- >0;)for(t=e.alias[e.string[l]]||[],r=t.length;r-- >0;)e.string.push(t[r]);if(y){for(s in e.default)if(i=typeof e.default[s],t=e.alias[s]=e.alias[s]||[],e[i]!==void 0)for(e[i].push(s),l=0;l<t.length;l++)e[i].push(t[l])}let w=u?Object.keys(e.alias):[];for(l=0;l<p;l++){if(n=o[l],n==="--"){c._=c._.concat(o.slice(++l));break}for(r=0;r<n.length&&n.charCodeAt(r)===45;r++);if(r===0)c._.push(n);else if(n.substring(r,r+3)==="no-"){if(i=n.substring(r+3),u&&!~w.indexOf(i))return e.unknown(n);c[i]=!1}else{for(h=r+1;h<n.length&&n.charCodeAt(h)!==61;h++);for(i=n.substring(r,h),a=n.substring(++h)||l+1===p||(""+o[l+1]).charCodeAt(0)===45||o[++l],t=r===2?[i]:i,h=0;h<t.length;h++){if(i=t[h],u&&!~w.indexOf(i))return e.unknown("-".repeat(r)+i);V(c,i,h+1<t.length||a,e)}}}if(y)for(s in e.default)c[s]===void 0&&(c[s]=e.default[s]);if(m)for(s in c)for(t=e.alias[s]||[];t.length>0;)c[t.shift()]=c[s];return c}var x=o=>o.replace(/[<[].+/,"").trim(),T=o=>{let e=/<([^>]+)>/g,s=/\[([^\]]+)\]/g,t=[],n=c=>{let l=!1,r=c[1];return r.startsWith("...")&&(r=r.slice(3),l=!0),{required:c[0].startsWith("<"),value:r,variadic:l}},i;for(;i=e.exec(o);)t.push(n(i));let a;for(;a=s.exec(o);)t.push(n(a));return t},B=o=>{let e={alias:{},boolean:[]};for(let[s,t]of o.entries())t.names.length>1&&(e.alias[t.names[0]]=t.names.slice(1)),t.isBoolean&&(t.negated&&o.some((i,a)=>a!==s&&i.names.some(c=>t.names.includes(c))&&typeof i.required=="boolean")||e.boolean.push(t.names[0]));return e},$=o=>o.sort((e,s)=>e.length>s.length?-1:1)[0],v=(o,e)=>o.length>=e?o:`${o}${" ".repeat(e-o.length)}`,M=o=>o.replace(/([a-z])-([a-z])/g,(e,s,t)=>s+t.toUpperCase()),G=(o,e,s)=>{let t=0,n=e.length,i=o,a;for(;t<n;++t)a=i[e[t]],i=i[e[t]]=t===n-1?s:a!=null?a:!!~e[t+1].indexOf(".")||!(+e[t+1]>-1)?{}:[]},U=(o,e)=>{for(let s of Object.keys(e)){let t=e[s];t.shouldTransform&&(o[s]=Array.prototype.concat.call([],o[s]),typeof t.transformFunction=="function"&&(o[s]=o[s].map(t.transformFunction)))}},H=o=>{let e=/([^\\\/]+)$/.exec(o);return e?e[1]:""},A=o=>o.split(".").map((e,s)=>s===0?M(e):e).join("."),f=class extends Error{constructor(e){super(e);this.name=this.constructor.name,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(e).stack}},N=class{constructor(e,s,t){this.rawName=e,this.description=s,this.config=Object.assign({},t),e=e.replace(/\.\*/g,""),this.negated=!1,this.names=x(e).split(",").map(n=>{let i=n.trim().replace(/^-{1,2}/,"");return i.startsWith("no-")&&(this.negated=!0,i=i.replace(/^no-/,"")),A(i)}).sort((n,i)=>n.length>i.length?1:-1),this.name=this.names[this.names.length-1],this.negated&&this.config.default==null&&(this.config.default=!0),e.includes("<")?this.required=!0:e.includes("[")?this.required=!1:this.isBoolean=!0}},I=process.argv,L=`${process.platform}-${process.arch} node-${process.version}`,k=class{constructor(e,s,t={},n){this.rawName=e,this.description=s,this.config=t,this.cli=n,this.options=[],this.aliasNames=[],this.name=x(e),this.args=T(e),this.examples=[]}usage(e){return this.usageText=e,this}allowUnknownOptions(){return this.config.allowUnknownOptions=!0,this}ignoreOptionDefaultValue(){return this.config.ignoreOptionDefaultValue=!0,this}version(e,s="-v, --version"){return this.versionNumber=e,this.option(s,"Display version number"),this}example(e){return this.examples.push(e),this}option(e,s,t){let n=new N(e,s,t);return this.options.push(n),this}alias(e){return this.aliasNames.push(e),this}action(e){return this.commandAction=e,this}isMatched(e){return this.name===e||this.aliasNames.includes(e)}get isDefaultCommand(){return this.name===""||this.aliasNames.includes("!")}get isGlobalCommand(){return this instanceof C}hasOption(e){return e=e.split(".")[0],this.options.find(s=>s.names.includes(e))}outputHelp(){let{name:e,commands:s}=this.cli,{versionNumber:t,options:n,helpCallback:i}=this.cli.globalCommand,a=[{body:`${e}${t?`/${t}`:""}`}];if(a.push({title:"Usage",body:`  $ ${e} ${this.usageText||this.rawName}`}),(this.isGlobalCommand||this.isDefaultCommand)&&s.length>0){let r=$(s.map(h=>h.rawName));a.push({title:"Commands",body:s.map(h=>`  ${v(h.rawName,r.length)}  ${h.description}`).join(`
`)}),a.push({title:"For more info, run any command with the `--help` flag",body:s.map(h=>`  $ ${e}${h.name===""?"":` ${h.name}`} --help`).join(`
`)})}let l=this.isGlobalCommand?n:[...this.options,...n||[]];if(l.length>0){let r=$(l.map(h=>h.rawName));a.push({title:"Options",body:l.map(h=>`  ${v(h.rawName,r.length)}  ${h.description} ${h.config.default===void 0?"":`(default: ${h.config.default})`}`).join(`
`)})}this.examples.length>0&&a.push({title:"Examples",body:this.examples.map(r=>typeof r=="function"?r(e):r).join(`
`)}),i&&(a=i(a)||a),console.log(a.map(r=>r.title?`${r.title}:
${r.body}`:r.body).join(`

`))}outputVersion(){let{name:e}=this.cli,{versionNumber:s}=this.cli.globalCommand;s&&console.log(`${e}/${s} ${L}`)}checkRequiredArgs(){let e=this.args.filter(s=>s.required).length;if(this.cli.args.length<e)throw new f(`missing required args for command \`${this.rawName}\``)}checkUnknownOptions(){let{options:e,globalCommand:s}=this.cli;if(!this.config.allowUnknownOptions){for(let t of Object.keys(e))if(t!=="--"&&!this.hasOption(t)&&!s.hasOption(t))throw new f(`Unknown option \`${t.length>1?`--${t}`:`-${t}`}\``)}}checkOptionValue(){let{options:e,globalCommand:s}=this.cli,t=[...s.options,...this.options];for(let n of t){let i=e[n.name.split(".")[0]];if(n.required){let a=t.some(c=>c.negated&&c.names.includes(n.name));if(i===!0||i===!1&&!a)throw new f(`option \`${n.rawName}\` value is missing`)}}}},C=class extends k{constructor(e){super("@@global@@","",{},e)}},d=Object.assign,E=class extends _events.EventEmitter{constructor(e=""){super();this.name=e,this.commands=[],this.rawArgs=[],this.args=[],this.options={},this.globalCommand=new C(this),this.globalCommand.usage("<command> [options]")}usage(e){return this.globalCommand.usage(e),this}command(e,s,t){let n=new k(e,s||"",t,this);return n.globalCommand=this.globalCommand,this.commands.push(n),n}option(e,s,t){return this.globalCommand.option(e,s,t),this}help(e){return this.globalCommand.option("-h, --help","Display this message"),this.globalCommand.helpCallback=e,this.showHelpOnExit=!0,this}version(e,s="-v, --version"){return this.globalCommand.version(e,s),this.showVersionOnExit=!0,this}example(e){return this.globalCommand.example(e),this}outputHelp(){this.matchedCommand?this.matchedCommand.outputHelp():this.globalCommand.outputHelp()}outputVersion(){this.globalCommand.outputVersion()}setParsedInfo({args:e,options:s},t,n){return this.args=e,this.options=s,t&&(this.matchedCommand=t),n&&(this.matchedCommandName=n),this}unsetMatchedCommand(){this.matchedCommand=void 0,this.matchedCommandName=void 0}parse(e=I,{run:s=!0}={}){this.rawArgs=e,this.name||(this.name=e[1]?H(e[1]):"cli");let t=!0;for(let i of this.commands){let a=this.mri(e.slice(2),i),c=a.args[0];if(i.isMatched(c)){t=!1;let l=d(d({},a),{args:a.args.slice(1)});this.setParsedInfo(l,i,c),this.emit(`command:${c}`,i)}}if(t){for(let i of this.commands)if(i.name===""){t=!1;let a=this.mri(e.slice(2),i);this.setParsedInfo(a,i),this.emit("command:!",i)}}if(t){let i=this.mri(e.slice(2));this.setParsedInfo(i)}this.options.help&&this.showHelpOnExit&&(this.outputHelp(),s=!1,this.unsetMatchedCommand()),this.options.version&&this.showVersionOnExit&&(this.outputVersion(),s=!1,this.unsetMatchedCommand());let n={args:this.args,options:this.options};return s&&this.runMatchedCommand(),!this.matchedCommand&&this.args[0]&&this.emit("command:*"),n}mri(e,s){let t=[...this.globalCommand.options,...s?s.options:[]],n=B(t),i=[],a=e.indexOf("--");a>-1&&(i=e.slice(a+1),e=e.slice(0,a));let c=R(e,n);c=Object.keys(c).reduce((m,u)=>d(d({},m),{[A(u)]:c[u]}),{_:[]});let l=c._,r={"--":i},h=s&&s.config.ignoreOptionDefaultValue?s.config.ignoreOptionDefaultValue:this.globalCommand.config.ignoreOptionDefaultValue,p=Object.create(null);for(let m of t){if(!h&&m.config.default!==void 0)for(let u of m.names)r[u]=m.config.default;Array.isArray(m.config.type)&&p[m.name]===void 0&&(p[m.name]=Object.create(null),p[m.name].shouldTransform=!0,p[m.name].transformFunction=m.config.type[0])}for(let m of Object.keys(c))if(m!=="_"){let u=m.split(".");G(r,u,c[m]),U(r,p)}return{args:l,options:r}}runMatchedCommand(){let{args:e,options:s,matchedCommand:t}=this;if(!t||!t.commandAction)return;t.checkUnknownOptions(),t.checkOptionValue(),t.checkRequiredArgs();let n=[];return t.args.forEach((i,a)=>{i.variadic?n.push(e.slice(a)):n.push(e[a])}),n.push(s),t.commandAction.apply(this,n)}},g=(o="")=>new E(o);typeof module!="undefined"&&(module.exports=g,module.exports.default=g,module.exports.cac=g);var q=g;var _listr = require('listr'); var _listr2 = _interopRequireDefault(_listr);var z=j(),K=q("prerelease-checks").usage(" ").option("--release-branch","Branch releases must happen from",{default:"master"}).option("--required-npm","Required semver range for npm",{default:">=6.8.0"}).option("--required-git","Required semver range for Git",{default:">=2.11.0"}).help().version(z.version),O=K.parse().options;!O.help&&!O.version&&new (0, _listr2.default)([{title:"npm",task:()=>_chunkZEVP7U72js.a},{title:"Git",skip:async()=>!await _chunkCJWOCGNFjs.a.call(void 0, )&&"Not a git repo. Skipping git checks.",task:()=>_chunkCJWOCGNFjs.b}]).run(O).catch(()=>{process.exit(1)});
